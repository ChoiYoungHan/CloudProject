<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë‰´ìŠ¤ í˜ì´ì§€</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<!-- ìƒë‹¨ ë°” -->
<div class="top-bar">
  <div class="logo">
    <img src="{{ url_for('static', filename='logo.png') }}" alt="ë¡œê³ ">
  </div>

  <div class="search-box">
    <form method="GET" action="/" class="search-form">
      <input type="text" name="keyword" placeholder="ê²€ìƒ‰ì°½">
      <button type="submit">ğŸ”</button>
    </form>
  </div>
</div>

<!-- ì¹´í…Œê³ ë¦¬ íƒ­ -->
<div class="category-tabs">
  <button onclick="loadAll()">ì „ì²´</button>
  <button onclick="loadCategory('politics')">ì •ì¹˜</button>
  <button onclick="loadCategory('society')">ì‚¬íšŒ</button>
  <button onclick="loadCategory('entertainment')">ì—°ì˜ˆ</button>
</div>

<!-- ë‰´ìŠ¤ ë¦¬ìŠ¤íŠ¸ í…Œì´ë¸” -->
<table class="news-table">
  <thead>
    <tr>
      <th>ì¹´í…Œê³ ë¦¬</th>
      <th>ì œëª©</th>
      <th>ì‘ì„±ì</th>
      <th>ì‘ì„±ì¼</th>
    </tr>
  </thead>
  <tbody>
    {% for news in news_list %}
    <tr>
      <td>{{ news.category }}</td>
      <td class="title">
        <a href="#"
           data-category="{{ news.category }}"
           data-title="{{ news.title }}"
           data-timestamp="{{ news.timestamp }}">
           {{ news.title }}
        </a>
      </td>
      <td>{{ news.author }}</td>
      <td>{{ news.date }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- ìƒì„¸ ë‰´ìŠ¤ ì˜ì—­ -->
<div class="news-detail" style="display: none;">
  <h2 id="detail-title"></h2>
  <p><strong>ì‘ì„±ì¼:</strong> <span id="detail-date"></span></p>
  <p><strong>ì‘ì„±ì:</strong> <span id="detail-author"></span></p>
  <p id="detail-content"></p>
  <button onclick="goBackToList()">â† ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
</div>

<script>
  const categoryMap = {
    'ì •ì¹˜': 'politics',
    'ì‚¬íšŒ': 'society',
    'ì—°ì˜ˆ': 'entertainment'
  };

  function loadCategory(cat) {
    const url = `http://k8s-default-newsingr-fc76efc355-1769841591.us-west-2.elb.amazonaws.com/category/${cat}`;
    history.pushState(null, '', `/category/${cat}`);

    fetch(url)
      .then(res => res.json())
      .then(data => {
        const tbody = document.querySelector('.news-table tbody');
        tbody.innerHTML = '';

        data.forEach(item => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${item.category}</td>
            <td class="title">
              <a href="#"
                 data-category="${item.category}"
                 data-title="${item.title}"
                 data-timestamp="${item.timestamp}">
                 ${item.title}
              </a>
            </td>
            <td>${item.author}</td>
            <td>${item.timestamp.split("T")[0]}</td>
          `;
          tbody.appendChild(tr);
        });

        document.querySelector('.news-table').style.display = 'table';
        document.querySelector('.news-detail').style.display = 'none';
      });
  }

  function loadAll() {
    fetch(`http://k8s-default-newsingr-fc76efc355-1769841591.us-west-2.elb.amazonaws.com/api/all`)
      .then(res => res.json())
      .then(data => {
        history.pushState(null, '', `/all`);
        const tbody = document.querySelector('.news-table tbody');
        tbody.innerHTML = '';

        data.forEach(item => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${item.category}</td>
            <td class="title">
              <a href="#"
                 data-category="${item.category}"
                 data-title="${item.title}"
                 data-timestamp="${item.timestamp}">
                 ${item.title}
              </a>
            </td>
            <td>${item.author}</td>
            <td>${item.timestamp.split("T")[0]}</td>
          `;
          tbody.appendChild(tr);
        });

        document.querySelector('.news-table').style.display = 'table';
        document.querySelector('.news-detail').style.display = 'none';
      });
  }

  document.addEventListener('click', function (e) {
    if (e.target.matches('.title a')) {
      e.preventDefault();

      const categoryKo = e.target.dataset.category;
      const category = categoryMap[categoryKo];
      const title = e.target.dataset.title;
      const timestamp = e.target.dataset.timestamp;
      const encodedTitle = encodeURIComponent(title);

      const url = `http://k8s-default-newsingr-fc76efc355-1769841591.us-west-2.elb.amazonaws.com/category/${category}/${timestamp}/${encodedTitle}`;

      history.pushState(null, '', `/category/${category}/${timestamp}/${encodedTitle}`);


      fetch(url)
        .then(res => res.json())
        .then(data => {
          document.querySelector('.news-table').style.display = 'none';
          document.querySelector('.news-detail').style.display = 'block';

          document.getElementById('detail-title').textContent = data.title;
          document.getElementById('detail-date').textContent = data.timestamp.split("T")[0];
          document.getElementById('detail-author').textContent = data.author;
          document.getElementById('detail-content').textContent = data.content;
        });
    }
  });

  function goBackToList() {
    document.querySelector('.news-detail').style.display = 'none';
    document.querySelector('.news-table').style.display = 'table';
  }
</script>

</body>
</html>
